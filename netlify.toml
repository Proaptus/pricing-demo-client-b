# Netlify Configuration for Red Pegasus Pricing Model
# Documentation: https://docs.netlify.com/configure-builds/file-based-configuration/

# Build Settings
[build]
  # Command to build the production bundle
  command = "npm run build"

  # Directory containing the production build output
  publish = "dist"

  # Node version for build environment
  [build.environment]
    NODE_VERSION = "18"

# SPA Redirect Rules
# Ensures React Router works correctly by redirecting all routes to index.html
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Security Headers
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent clickjacking attacks
    X-Frame-Options = "DENY"

    # Prevent MIME type sniffing
    X-Content-Type-Options = "nosniff"

    # Enable browser XSS protection
    X-XSS-Protection = "1; mode=block"

    # Referrer policy for privacy
    Referrer-Policy = "strict-origin-when-cross-origin"

    # Content Security Policy
    # Allows:
    # - Scripts from self and inline (for React)
    # - Styles from self and inline (for Tailwind)
    # - Images from self, data URIs, Firebase Storage, Google Cloud Storage, and Red Pegasus CDN
    # - Fonts from self and data URIs
    # - Connections to Google APIs for authentication, storage, and data access
    Content-Security-Policy = '''
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: https://firebasestorage.googleapis.com https://www.redpegasus.co.uk;
      font-src 'self' data:;
      connect-src 'self' https://storage.googleapis.com https://www.googleapis.com https://oauth2.googleapis.com https://*.googleapis.com;
      frame-ancestors 'none';
      base-uri 'self';
      form-action 'self';
    '''

    # Permissions policy - restrict access to sensitive APIs
    Permissions-Policy = "camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()"

    # CORS headers for API access (if needed)
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, POST, PUT, DELETE, OPTIONS"
    Access-Control-Allow-Headers = "Origin, X-Requested-With, Content-Type, Accept, Authorization"

# Cache Control Headers for Assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache Control for JavaScript/CSS bundles
[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache Control for HTML
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

# Cache Control for JSON data files
[[headers]]
  for = "/*.json"
  [headers.values]
    Cache-Control = "public, max-age=3600, must-revalidate"

# Note: Built-in Authentication
# ==============================
# This application includes a built-in login page with password protection.
# The default password is: redpegasus2024
#
# To change the password:
# 1. Open src/components/Login.jsx
# 2. Update the CORRECT_PASSWORD constant
# 3. Commit and redeploy
#
# The password is stored in the client code and uses sessionStorage for authentication.
# Users will need to re-login when they close their browser.

# Note: Google Cloud Storage Integration
# ==============================
# This application integrates with Google Cloud Storage for:
# - Storing pricing data exports
# - Retrieving benchmark data
#
# The GCS bucket 'red-pegasus-pricing-data' is configured for public read access
# for benchmark data and authenticated write access for exports.

